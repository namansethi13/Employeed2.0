{% load static %} {% load addcss %}

<!DOCTYPE html>
<html lang="en">
   <head>
      {% block script %} {% endblock script %}

      <!-- Google Fonts -->
      <link
         href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
         rel="stylesheet"
      />

      <!-- MBD CSS -->
      <link
         href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.4.0/mdb.min.css"
         rel="stylesheet"
      />

      <!-- Bootstrap css -->
      <link
         rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
         integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
         crossorigin="anonymous"
      />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>


      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/css/bootstrap-datetimepicker.min.css"> 
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/css/bootstrap-datetimepicker-standalone.css"> 
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.43/js/bootstrap-datetimepicker.min.js"></script>

      <!-- Remixicons css -->
      <link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
      
      <!-- Internal css -->
      <link rel="stylesheet" href="{% static 'css/style.css' %}" />
      <link rel="stylesheet" href="{% static 'css/collegeDash.css' %}">
   </head>
   <body>
      {% block navbar %}
      <div class="alerthere"></div>
      <header id="header" class="fixed-top">
         <div class="container-fluid">
            <div class="row justify-content-center">
               <div
                  class="col-xl-9 d-flex align-items-center justify-content-lg-between"
               >
                  <h1 class="logo me-auto me-lg-0">
                     <a href="{% url 'home' %}">Employeed</a>
                  </h1>
                  <nav id="navbar" class="navbar order-last order-lg-0">
                     <ul>
                        <li>
                           <a class="nav-link scrollto" href="#hero"
                              >Dashboard</a
                           >
                        </li>
                        <li>
                           <a class="nav-link scrollto" id = "joblist" href="{% url 'job_list' %}"
                              >Job List</a
                           >
                        </li>
                        <li>
                           <a class="nav-link scrollto" href="{% url 'test_list' %}" id = "testlist"
                              >Test List</a
                           >
                        </li>
                     </ul>
                     <i class="bi bi-list mobile-nav-toggle"></i>
                  </nav>
                  <!-- .navbar -->

                  {% if user.is_authenticated%}
                  <div
                     class="row d-flex justify-content-center align-items-center"
                  >
                  <div class="col">
                     <!-- Notifications -->
                <div class="dropdown dropstart">
        <a
          class="dropdown-toggle d-flex align-items-center hidden-arrow"
          role="button"
          id="dropdownMenuButton"
          data-mdb-toggle="dropdown"
          aria-expanded="false"
        >
        <span id="notificationCount"></span>
          <i class="ri-notification-3-fill ri-2x"></i>
                </a>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" >
          <div id ="notification">
      
          </div>
          <hr class="dropdown-divider" />
          <a class="dropdown-item" href="{%url 'notfications' %}" >VIEW ALL</a>
        </div>
        
      
      </div>
      
                  </div>
                     <div class="col">
                        <!-- Profile -->
                        <div class="dropdown">
                           <a
                              class="dropdown-toggle d-flex align-items-center hidden-arrow"
                              href="#"
                              id="navbarDropdownMenuAvatar"
                              role="button"
                              data-mdb-toggle="dropdown"
                              aria-expanded="false"
                           >
                              <i class="ri-account-circle-fill ri-3x"></i>
                           </a>
                           <ul
                              class="dropdown-menu dropdown-menu-end"
                              aria-labelledby="navbarDropdownMenuAvatar"
                           >
                              {% if user.role == "COLLEGE" %}
                              <li>
                                 <a
                                    class="dropdown-item"
                                    href="{% url 'college_dashboard' %}"
                                    >Dashboard</a
                                 >
                              </li>
                              {% else %}
                              <li>
                                 <a class="dropdown-item" href="#">Profile</a>
                              </li>
                              {% endif %}
                              <li>
                                 <a class="dropdown-item" href="#">Settings</a>
                              </li>
                              <div class="dropdown-divider"></div>
                              <li>
                                 <a
                                    class="dropdown-item text-danger"
                                    href="{% url 'logout' %}"
                                    >Log out</a
                                 >
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  {% else %}
                  <div class="hstack gap-2">
                     <a href="{% url 'login' %}">
                        <button
                           class="btn btn-success btn-sm"
                           data-bs-toggle="modal"
                           data-bs-target="#modalLogin"
                        >
                           Login
                        </button>
                     </a>
                     <a href="{% url 'signup' %}">
                        <button
                           class="btn btn-success btn-sm"
                           data-bs-toggle="modal"
                           data-bs-target="#modalLogin"
                        >
                           Signup
                        </button>
                     </a>
                  </div>
                  {% endif %}
               </div>
            </div>
         </div>
      </header>
      <!-- End Header -->
      {% endblock navbar %}

      {% block content %} 
      {% endblock content %}

      <!-- MDB js -->
      <script
         type="text/javascript"
         src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.4.0/mdb.min.js"
      ></script>

      <script src="{% static 'js/corpdash.js' %}"></script>
      <!-- To make the link in navbar active by default based upon url -->
      <script>
         function changeActiveElement(substring){
            url = String(window.location.href);
            let count = url.split(substring).length-1;
            return count;
         }


         if(changeActiveElement("jobs/list") > 0)
         {
            document.getElementById("joblist").classList.add("active");
         }

         if(changeActiveElement("tests") > 0)
         {
            document.getElementById("testlist").classList.add("active");
         }
      </script>
      <script>
         class alertBox {
            constructor(element) {
        
                    this.box = "<div id=\"alert1\" ><div class=\"alert-box\"><div class=\"alert-message\" id =\"alert-message\">" + element.getAttribute("msgbody") + "</div><div class=\"alert-buttons\"><a id=\"alert-ok\" type=\"button\">Ok</</div><!-- .alert-buttons --></div><!-- .alert-box --></div>"
                    $(".alerthere").append(this.box);
                    let alertok = document.getElementById("alert-ok");
                    alertok.onclick = () => {
        
                        $(".alerthere").empty()
                    }
        
                }
        
        
            }
                 let url = "ws://127.0.0.1:8000/ws/notify-socket/";
        
                 const chatSocket = new WebSocket(url);
        
                 chatSocket.onmessage = function (e) {
                    let data = JSON.parse(e.data);
                    console.log("Data ", data);
        
                    if (data.type === "chat") {
                       let notification = document.getElementById("notification");
                       notification.innerHTML = "";
                       for (msg in data.messages) {
                          console.log(data.messages[msg]);
                          notification.insertAdjacentHTML(
                             "afterbegin",
                             '<a class="dropdown-item" href="#" onclick="setSeenTrue(this)"' + 'msgid= \"'+data.messages[msg].id+'\" ' + 'msgbody= \"'+data.messages[msg].body+'\"  data-mdb-toggle="modal" data-mdb-target="#messageinfo"'+data.messages[msg].id+'\""> ' +
                                data.messages[msg].heading +
                                "</a>" +""
              //                   "<div class=\"modal fade\" id=\"#messageinfo"+data.messages[msg].id+"\" tabindex=\"-1\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><h5 class=\"modal-title\" id=\"exampleModalLabel\">Modal title</h5>"+
              //   "<button type=\"button\" class=\"btn-close\" data-mdb-dismiss=\"modal\" aria-label=\"Close\"></button>"+
              // "</div><div class=\"modal-body\">...</div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" data-mdb-dismiss=\"modal\">Close</button>"+
              //   "<button type=\"button\" class=\"btn btn-primary\">Save changes</button></div></div</div></div>"
                                
                          );
                       }
        
                       let notification_count =
                          document.getElementById("notificationCount");
                       console.log(data.count);
                       notification_count.innerText = data.count;
                    }
                 };
        
                 function setSeenTrue(element) {
                  box = new alertBox(element);
                    const id =  element.getAttribute('msgid');
                    chatSocket.send(
                       JSON.stringify({
                          id: id,
                       })
                    );
                 }
               </script>
   </body>
</html>
